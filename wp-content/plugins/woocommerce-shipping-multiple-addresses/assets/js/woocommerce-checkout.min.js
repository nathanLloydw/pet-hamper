var last_id="",_multi_shipping=!1,_ms_reloaded=!1;function supports_html5_storage(){try{$supports_html5_storage="sessionStorage"in window&&null!==window.sessionStorage,window.sessionStorage.setItem("mship","test"),window.sessionStorage.removeItem("mship")}catch(e){$supports_html5_storage=!1}return $supports_html5_storage}function wcms_resize_thickbox(){jQuery(window).width()<400&&(jQuery(document).find("#TB_window").css({width:"300px",marginLeft:"-"+parseInt(150,10)+"px"}),jQuery(document).find("#TB_ajaxContent").css("width","auto"))}jQuery(document).ready(function(c){var a,s;function e(e){if(-1==c.inArray(e.getDay(),WCMS.datepicker_valid_days))return[!1];var t=e.getMonth()+1+"-"+e.getDate()+"-"+e.getFullYear(),e=WCMS.datepicker_excluded_dates.map(function(e){return e.replace(/(^|-)0+/g,"$1")});return-1!=c.inArray(t,e)?[!1]:[!0]}supports_html5_storage()&&(a={},s={},c("form.checkout").on("blur",".woocommerce-billing-fields :input",function(){var e=c(this).attr("id"),t=c(this).val();a[e]=t,localStorage.setItem("wcms_billing_fields",JSON.stringify(a))}),c("form.checkout").on("blur",".woocommerce-shipping-fields :input",function(){var e=c(this).attr("id"),t=c(this).val();s[e]=t,localStorage.setItem("wcms_shipping_fields",JSON.stringify(s))}),c("form.checkout :input").trigger("blur")),c("a.ms_delete_address").click(function(e){e.preventDefault();var e=c(this).data("idx"),t=c(this).parents(".address-block");c(t).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.post(WCMS.ajaxurl,{action:"wc_ms_delete_address",idx:e},function(e){c(t).unblock(),c(t).remove()})}),c("select.shipping_methods").on("change",function(){c("body").trigger("update_checkout")}),c("[name=shipping_method]").on("change",function(){"local_pickup"==c(this).val()||"local_pickup_plus"==c(this).val()?c("#wcms_message").hide():1==c("#wcms_message").data("allowed")&&c("#wcms_message").show()}).change(),c("body").on("updated_checkout",function(){_multi_shipping&&(c("tr.shipping").remove(),_ms_reloaded||(c("body").trigger("update_checkout"),_ms_reloaded=!0),c(".ms_shipping_date").datepicker({beforeShowDay:e,minDate:0}),c(".ms_shipping_date").attr("readOnly","true"))}),c(".user-add-address").click(function(e){e.preventDefault();for(var t="",a=c("#address_form_template").html();t=Math.floor(99999999*Math.random())+1,a=a.replace(/(\|sig\|)/gi,t),1<=c("#shipping_address_"+t).length;);tb_show("New Address","#TB_inline?height=520&width=400&inlineId=address_form_template&sig="+t),wcms_resize_thickbox()}),c(".add-address").click(function(e){e.preventDefault();var t="";for(c("#address_form_template").html();t=Math.floor(99999999*Math.random())+1,c("#address_id").val(t),1<=c("#shipping_address_"+t).length;);tb_show("New Address","#TB_inline?height=520&width=400&inlineId=address_form_template&sig="+t),wcms_resize_thickbox()}),c(".user-duplicate-cart").click(function(e){e.preventDefault(),tb_show("Shipping Address","#TB_inline?height=520&width=400&inlineId=duplicate_address_form_template"),wcms_resize_thickbox()}),c("#add_address_form").submit(function(){var i=this;jQuery(i).block({message:null,overlayCSS:{background:"#fff url("+WCMS.wc_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}}),c("p.woocommerce-invalid").removeClass("woocommerce-invalid");var e=c(this).serialize()+"&action=wc_save_to_address_book";return c.post(WCMS.ajaxurl,e,function(e){var t=JSON.parse(e);if("OK"==t.ack)c("#add_address_form")[0].reset(),window.location.href=t.next;else if("ERR"==t.ack){if(t.errors&&0<t.errors.length)for(var a=0;a<t.errors.length;a++){var s=t.errors[a];c("input[name='address["+s+"]']").parent("p").addClass("woocommerce-invalid")}jQuery(i).unblock(),alert(t.message)}}),!1}),c("#duplicate_cart_form").submit(function(){var e=c(this).serialize()+"&action=wc_duplicate_cart";return c.post(WCMS.ajaxurl,e,function(e){var t,a=JSON.parse(e);"OK"==a.ack?(tb_remove(),t=a.id,e=a.html,c("#addresses_container").prepend(e),c("#items_column_"+t).droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(e,t){var a=c(t.draggable).data("quantity"),s=1;if(1<a){if(null==(s=prompt("Enter the quantity (1-"+a+"):","1")))return!1;s<1&&(s=1),a<(s=Math.floor(s))&&(s=a)}c(this).find(".placeholder").remove(),a-=s;var i=c(t.draggable).attr("id"),r=c(t.draggable).data("product-id"),d=c(".address-item-key-"+i,this).length,n=c(this).attr("id").split("_")[2];if(c(t.draggable).data("quantity",a),c(".qty",t.draggable).text(a),0==d){for(var d=c(t.draggable).attr("class").replace(/(cart\-item)/gi,"address-item"),o=c("<li></li>").attr("class",d).addClass("address-item-key-"+i).data("key",i).data("product-id",r).html(t.draggable.html()).appendTo(this),l=0;l<s;l++)c(o).append('<input type="hidden" name="items_'+n+'[]" value="'+i+'" />');c(o).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/assets/images/delete.png" title="Remove" /></a>').find(".qty").text(s),c(o).find("div.quantity").remove()}else{r=parseInt(c(".address-item-key-"+i,this).find(".qty").text());c(".address-item-key-"+i,this).find(".qty").text(r+s);for(l=0;l<s;l++)c(".address-item-key-"+i,this).append('<input type="hidden" name="items_'+n+'[]" value="'+i+'" />')}0==a&&c(t.draggable).remove(),c("#addresses_container").masonry("reload")}}),c("#addresses_container").masonry("reload")):"ERR"==a.ack&&alert(a.message)}),!1}),c(".address-use").click(function(){var e=JSON.parse(c(this).parents("p").prev("textarea").val());c(this).prop("disabled",!0),c(".add-address").click(),setAddress(e,last_id)}),c("#cart_items ul li").draggable({appendTo:"body",helper:"clone",revert:!1,cursorAt:{left:50,top:30}}),c("li.address-item > a.remove").on("click",function(e){e.preventDefault();var t=c(this).parents("li.address-item"),a=c(t).parents(".items-column"),s=parseInt(c(t).find(".qty").text()),i=c(t).data("key"),r=c(t).data("product-id");0<c("#"+i).length?(e=parseInt(c("#"+i).find(".qty").text())+s,c("#"+i).data("quantity",e).find(".qty").text(e)):(r=c("<li></li>").html(c(t).html()).data("quantity",s).data("product-id",r).attr("class",c(t).attr("class").replace(/(address\-item)/gi,"cart-item")).attr("id",c(t).data("key")),c(r).find("a.remove").remove(),c(r).find("input").remove(),c(r).appendTo("ul.cart-items"),c(r).draggable({appendTo:"body",helper:"clone",revert:!1,cursorAt:{left:0,top:0}})),c(t).remove(),0==c(a).children("li").length&&c(a).append('<li class="placeholder">Drag items here</li>'),c("#addresses_container").masonry("reload")}),c("#address_form").submit(function(){if(0<c(".cart-items li").length)return alert("Please assign a shipping address for all your cart items."),!1}),c(".items-column").droppable({activeClass:"ui-state-default",hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(e,t){var a=c(t.draggable).data("quantity"),s=1;if(1<a){if(null==(s=prompt("Enter the quantity (1-"+a+"):","1")))return!1;s<1&&(s=1),a<(s=Math.floor(s))&&(s=a)}c(this).find(".placeholder").remove(),a-=s;var i=c(t.draggable).attr("id"),r=c(t.draggable).data("product-id"),d=c(".address-item-key-"+i,this).length,n=c(this).attr("id").split("_")[2];if(c(t.draggable).data("quantity",a),c(".qty",t.draggable).text(a),0==d){for(var d=c(t.draggable).attr("class").replace(/(cart\-item)/gi,"address-item"),o=c("<li></li>").attr("class",d).addClass("address-item-key-"+i).data("key",i).data("product-id",r).html(t.draggable.html()).appendTo(this),l=0;l<s;l++)c(o).append('<input type="hidden" name="items_'+n+'[]" value="'+i+'" />');c(o).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/assets/images/delete.png" title="Remove" /></a>').find(".qty").text(s),c(o).find("div.quantity").remove()}else{r=parseInt(c(".address-item-key-"+i,this).find(".qty").text());c(".address-item-key-"+i,this).find(".qty").text(r+s);for(l=0;l<s;l++)c(".address-item-key-"+i,this).append('<input type="hidden" name="items_'+n+'[]" value="'+i+'" />')}0==a&&c(t.draggable).remove(),jQuery("#addresses_container").masonry("reload")}});var t=WCMS.countries.replace(/&quot;/g,'"'),l=JSON.parse(t);jQuery("select.country_to_state").on("change",function(){var s=c(this).val(),i=c(this).closest("div").find('select[id^="address[shipping_state]"], input[id^="address[shipping_state]"]'),r=i.parent(),d=i.attr("name"),n=i.attr("id"),o=i.val();l[s]?0==l[s].length?r.fadeOut(200,function(){i.parent().find(".chzn-container").remove(),i.replaceWith('<input type="hidden" class="hidden" name="'+d+'" id="'+n+'" value="" />'),c("body").trigger("country_to_state_changed",[s,c(this).closest("div")])}):r.fadeOut(200,function(){var e,t="",a=l[s];for(e in a)t=t+'<option value="'+e+'">'+a[e]+"</option>";i.is("input")&&(i.replaceWith('<select name="'+d+'" id="'+n+'" class="state_select"></select>'),i=c(this).closest("div").find('select[id^="address[shipping_state]"], input[id^="address[shipping_state]"]')),i.html('<option value="">'+WCMS.select_state_text+"</option>"+t),i.val(o),c("body").trigger("country_to_state_changed",[s,c(this).closest("div")]),r.fadeIn(500)}):i.is("select")?r.fadeOut(200,function(){r.find(".chzn-container").remove(),i.replaceWith('<input type="text" class="input-text" name="'+d+'" id="'+n+'" />'),c("body").trigger("country_to_state_changed",[s,c(this).closest("div")]),r.fadeIn(500)}):i.is(".hidden")&&(r.find(".chzn-container").remove(),i.replaceWith('<input type="text" class="input-text" name="'+d+'" id="'+n+'" />'),c("body").trigger("country_to_state_changed",[s,c(this).closest("div")]),r.delay(200).fadeIn(500)),c("body").delay(200).trigger("country_to_state_changing",[s,c(this).closest("div")])}).change(),c("#ms_addresses").change(function(){var e=c("#ms_addresses option:selected"),t=e.data(),a="";if(""!=e.val()){for(var s in t)"shipping_"==s.substr(0,9)&&("shipping_state"==s?a=t[s]:(c(".woocommerce-shipping-fields #"+s).length&&c(".woocommerce-shipping-fields #"+s).val(t[s]).change(),c(".wcms-address-form .shipping_address #"+s).length&&c(".wcms-address-form .shipping_address #"+s).val(t[s]).change()));c("body").one("country_to_state_changed",function(){c(".woocommerce-shipping-fields #shipping_state").val(a).change(),c(".wcms-address-form .shipping_address #shipping_state").val(a).change()}),c(".woocommerce-shipping-fields #shipping_country, .wcms-address-form .shipping_address #shipping_country").change()}}).change(),c("#addresses_container").length&&c("#addresses_container").masonry({itemSelector:".account-address",isFitWidth:!0}),Modernizr&&Modernizr.touch&&(c("li.cart-item").on("click",function(){c(this).hasClass("cart-item-active")?(c(this).removeClass("cart-item-active"),c("#addresses_container .account-address").removeClass("drop-ready")):(c(this).addClass("cart-item-active"),c("#addresses_container .account-address").addClass("drop-ready"))}),c(".items-column").on("click",function(){var o=this;c("li.cart-item-active").each(function(){var e=this,t=c(e).data("quantity");c(o).find(".placeholder").remove(),--t;var a=c(e).attr("id"),s=c(e).data("product-id"),i=c(".address-item-key-"+a,o).length,r=c(o).attr("id").split("_")[2];if(c(e).data("quantity",t),c(".qty",e).text(t),0==i){var i=c(e).attr("class").replace(/(cart\-item)/gi,"address-item"),d=c("<li></li>").attr("class",i).addClass("address-item-key-"+a).data("key",a).data("product-id",s).html(c(e).html());c(o).append(d);for(var n=0;n<1;n++)c(d).append('<input type="hidden" name="items_'+r+'[]" value="'+a+'" />');c(d).append('<a class="remove" href="#"><img style="width: 16px; height: 16px;" src="'+WCMS.base_url+'/assets/images/delete.png" title="Remove" /></a>').find(".qty").text(1),c(d).find("div.quantity").remove()}else{s=parseInt(c(".address-item-key-"+a,o).find(".qty").text());c(".address-item-key-"+a,o).find(".qty").text(s+1);for(n=0;n<1;n++)c(".address-item-key-"+a,o).append('<input type="hidden" name="items_'+r+'[]" value="'+a+'" />')}0==t&&c(e).remove(),jQuery("#addresses_container").masonry("reload")})})),c(".delete-line-item").on("click",function(){var e=c(this).data("key"),t=c(this).data("index");c("#delete_index").val(t),c("#delete_key").val(e)})}),jQuery(window).resize(function(){wcms_resize_thickbox()});
